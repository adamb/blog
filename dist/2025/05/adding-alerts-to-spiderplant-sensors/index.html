<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adding Alerts to Spiderplant Sensors - Adam's Blog</title>
  <link rel="icon" type="image/png" href="/assets/blogico.png" />
  <link rel="shortcut icon" href="/assets/blogico.png" />
  <link rel="apple-touch-icon" href="/assets/blogico.png" />
  <script src="/assets/htmx.min.js"></script>
  <link rel="stylesheet" href="/assets/style.css" />
  <script>
    // Track page visits
    function trackVisit() {
      fetch('/track', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      }).catch(err => console.log('Tracking failed:', err));
    }

    // Track initial page load
    document.addEventListener('DOMContentLoaded', trackVisit);

    // Track HTMX navigation (but not visit counter requests)
    document.addEventListener('htmx:afterRequest', function(evt) {
      if (evt.detail.successful && 
          evt.detail.requestConfig && 
          evt.detail.requestConfig.url && 
          !evt.detail.requestConfig.url.includes('/visits') &&
          !evt.detail.requestConfig.url.includes('/transform')) {
        trackVisit();
      }
    });
  </script>
</head>
<body>
  <header>
    <h1><a href="/" style="text-decoration: none; color: inherit;">Adam's Blog</a></h1>
    <nav>
      <a href="/about">About</a>
      
    </nav>
  </header>

  <main id="content">
    <article>
    <div id="post-content"><h1>Adding alerts to Spiderplant Sensors</h1>
<p><em>May 31, 2025 ‚Ä¢ <span class="visit-counter" hx-get="/visits?path=%2F2025%2F05%2Fadding-alerts-to-spiderplant-sensors%2F" hx-trigger="load" hx-swap="innerHTML">
<span class="visit-count">üëÅÔ∏è Loading...</span>
</span> ‚Ä¢ <span class="draft-badge">DRAFT</span></em></p>
<p>My friend Bob makes these absolutely brilliant sensors and runs the cloud service behind them. The sensors are perfect for monitoring things like temperature in my freezer or water levels in tanks - basically anywhere you need to keep an eye on environmental conditions without constantly checking manually.</p>
<p><em>[Photo of Spiderplant sensor - placeholder]</em></p>
<p>The problem? Bob's lab environment runs everything over HTTP, which is fine for internal use, but I wanted proper HTTPS access and some additional features like configurable alerts. Plus, having APIs that I could actually integrate with other services would be fantastic.</p>
<p>So naturally, I did what any reasonable person would do - I built a proxy service hosted on Cloudflare Workers to solve all these problems at once.</p>
<h2>The Solution: A Cloudflare Workers Proxy</h2>
<p>The code is up on <a href="https://github.com/adamb/spider">GitHub</a> if you want to follow along. The basic concept is straightforward: create an HTTPS proxy that sits between the internet and Bob's HTTP-only service, while adding some useful features along the way.</p>
<h3>How It Works</h3>
<p>The proxy is elegantly simple. When you hit <code>spider.dev.pr</code> (my Cloudflare Workers domain), it:</p>
<ol>
<li><strong>Forwards your request</strong> to the corresponding HTTP URL at <code>lab.spiderplant.com</code></li>
<li><strong>Rewrites any redirect headers</strong> to maintain HTTPS throughout</li>
<li><strong>Caches GET requests</strong> for 5 minutes to reduce load on Bob's servers</li>
<li><strong>Adds CORS headers</strong> so browsers don't complain about cross-origin requests</li>
</ol>
<p>The beauty of using Cloudflare Workers is that it's serverless - I don't need to maintain any infrastructure, it scales automatically, and it's ridiculously fast thanks to Cloudflare's global edge network.</p>
<h3>The APIs That Actually Matter</h3>
<p>One of the best parts about building this proxy was finally having proper APIs to work with. Here's what's available:</p>
<p><strong>Device Information</strong> (<code>/api/devices</code>)</p>
<pre><code class="language-json">{
  &quot;devices&quot;: [
    {
      &quot;id&quot;: &quot;sensor_001&quot;,
      &quot;name&quot;: &quot;Freezer Monitor&quot;,
      &quot;lastReport&quot;: &quot;2024-01-15T14:30:00Z&quot;
    }
  ]
}
</code></pre>
<p><strong>All Sensor Probes</strong> (<code>/api/probes</code>)
Lists every probe with details like ID, name, type, and the last reading.</p>
<p><strong>Specific Probe Values</strong> (<code>/api/probes/{probe_id}</code>)
The real money shot - current sensor readings with timestamps and metadata.</p>
<p><em>[Photo of sensor installed in freezer - placeholder]</em></p>
<h3>Adding Smart Alerts</h3>
<p>Here's where things get interesting. Using Cloudflare's KV storage, I can configure alert thresholds for different sensors without touching code. The system runs a cron job every 15 minutes to check all probe values against their configured thresholds.</p>
<p>When something goes wrong - like the freezer temperature spiking or the water tank running low - I get instant Pushover notifications on my phone. No more discovering problems hours later.</p>
<p><em>[Photo of sensor in water tank - placeholder]</em></p>
<p>The alert configuration is dead simple. Just store threshold values in KV storage like:</p>
<pre><code>probe_freezer_temp_max: -10
probe_water_level_min: 20
</code></pre>
<p>The worker automatically picks up these configurations and monitors accordingly.</p>
<h3>Why This Architecture Works</h3>
<p>Using Cloudflare Workers for this proxy made perfect sense:</p>
<ul>
<li><strong>Zero infrastructure maintenance</strong> - it just runs</li>
<li><strong>Global edge deployment</strong> - fast responses from anywhere</li>
<li><strong>Built-in caching</strong> - reduces load on Bob's servers</li>
<li><strong>KV storage</strong> - perfect for configuration and state</li>
<li><strong>Cron triggers</strong> - automated monitoring without external services</li>
</ul>
<p>The entire system costs basically nothing to run (thanks to Cloudflare's generous free tier) and provides enterprise-level reliability for a hobby project.</p>
<h2>The Results</h2>
<p>Now I have:</p>
<ul>
<li>‚úÖ Secure HTTPS access to all sensor data</li>
<li>‚úÖ Clean REST APIs for integration with other services</li>
<li>‚úÖ Configurable alerts that actually notify me when things go wrong</li>
<li>‚úÖ Automatic caching to keep things fast</li>
<li>‚úÖ Zero maintenance overhead</li>
</ul>
<p>The sensors are now monitoring my freezer temperature and water tank levels, with alerts configured so I know immediately if something needs attention. Bob's original hardware and cloud service remain unchanged - the proxy just adds the features I needed on top.</p>
<p><em>Pro tip</em>: If you're dealing with any HTTP-only service that you need to access securely or extend with additional features, Cloudflare Workers is an excellent solution. The development experience is smooth, deployment is instant, and the global performance is hard to beat.</p>
<p>Next up, I'm thinking about adding trend analysis and maybe some simple dashboards. But honestly, having reliable alerts for critical environmental monitoring has already solved my biggest problem.</p>
<p>The code is open source at <a href="https://github.com/adamb/spider">github.com/adamb/spider</a> if you want to build something similar for your own sensors or services.</p>
</div>
    
    <div class="tone-controls">
      <h3>üé≠ Transform This Post</h3>
      <div class="tone-buttons">
        <button onclick="transformPost('sarcastic')" class="tone-btn">
          üòè Sarcastic
        </button>
        <button onclick="transformPost('techbro')" class="tone-btn">
          üöÄ Tech Bro
        </button>
        <button onclick="transformPost('ubersnarky')" class="tone-btn">
          üò§ Uber Snarky
        </button>
        <button onclick="restoreOriginal()" class="tone-btn restore-btn">
          üîÑ Original
        </button>
      </div>
      <div id="loading-indicator" class="loading-indicator" style="display: none;">
        <span class="loading-text">ü§ñ AI is thinking... probably judging your writing style...</span>
      </div>
    </div>
    
    <script>
      // Store only the text content for AI transformation (no scripts)
      const originalMarkdownForAI = "\n# Adding alerts to Spiderplant Sensors\n\nMy friend Bob makes these absolutely brilliant sensors and runs the cloud service behind them. The sensors are perfect for monitoring things like temperature in my freezer or water levels in tanks - basically anywhere you need to keep an eye on environmental conditions without constantly checking manually.\n\n*[Photo of Spiderplant sensor - placeholder]*\n\nThe problem? Bob's lab environment runs everything over HTTP, which is fine for internal use, but I wanted proper HTTPS access and some additional features like configurable alerts. Plus, having APIs that I could actually integrate with other services would be fantastic.\n\nSo naturally, I did what any reasonable person would do - I built a proxy service hosted on Cloudflare Workers to solve all these problems at once.\n\n## The Solution: A Cloudflare Workers Proxy\n\nThe code is up on [GitHub](https://github.com/adamb/spider) if you want to follow along. The basic concept is straightforward: create an HTTPS proxy that sits between the internet and Bob's HTTP-only service, while adding some useful features along the way.\n\n### How It Works\n\nThe proxy is elegantly simple. When you hit `spider.dev.pr` (my Cloudflare Workers domain), it:\n\n1. **Forwards your request** to the corresponding HTTP URL at `lab.spiderplant.com`\n2. **Rewrites any redirect headers** to maintain HTTPS throughout\n3. **Caches GET requests** for 5 minutes to reduce load on Bob's servers\n4. **Adds CORS headers** so browsers don't complain about cross-origin requests\n\nThe beauty of using Cloudflare Workers is that it's serverless - I don't need to maintain any infrastructure, it scales automatically, and it's ridiculously fast thanks to Cloudflare's global edge network.\n\n### The APIs That Actually Matter\n\nOne of the best parts about building this proxy was finally having proper APIs to work with. Here's what's available:\n\n**Device Information** (`/api/devices`)\n```json\n{\n  \"devices\": [\n    {\n      \"id\": \"sensor_001\",\n      \"name\": \"Freezer Monitor\",\n      \"lastReport\": \"2024-01-15T14:30:00Z\"\n    }\n  ]\n}\n```\n\n**All Sensor Probes** (`/api/probes`)\nLists every probe with details like ID, name, type, and the last reading.\n\n**Specific Probe Values** (`/api/probes/{probe_id}`)\nThe real money shot - current sensor readings with timestamps and metadata.\n\n*[Photo of sensor installed in freezer - placeholder]*\n\n### Adding Smart Alerts\n\nHere's where things get interesting. Using Cloudflare's KV storage, I can configure alert thresholds for different sensors without touching code. The system runs a cron job every 15 minutes to check all probe values against their configured thresholds.\n\nWhen something goes wrong - like the freezer temperature spiking or the water tank running low - I get instant Pushover notifications on my phone. No more discovering problems hours later.\n\n*[Photo of sensor in water tank - placeholder]*\n\nThe alert configuration is dead simple. Just store threshold values in KV storage like:\n```\nprobe_freezer_temp_max: -10\nprobe_water_level_min: 20\n```\n\nThe worker automatically picks up these configurations and monitors accordingly.\n\n### Why This Architecture Works\n\nUsing Cloudflare Workers for this proxy made perfect sense:\n\n- **Zero infrastructure maintenance** - it just runs\n- **Global edge deployment** - fast responses from anywhere\n- **Built-in caching** - reduces load on Bob's servers\n- **KV storage** - perfect for configuration and state\n- **Cron triggers** - automated monitoring without external services\n\nThe entire system costs basically nothing to run (thanks to Cloudflare's generous free tier) and provides enterprise-level reliability for a hobby project.\n\n## The Results\n\nNow I have:\n- ‚úÖ Secure HTTPS access to all sensor data\n- ‚úÖ Clean REST APIs for integration with other services\n- ‚úÖ Configurable alerts that actually notify me when things go wrong\n- ‚úÖ Automatic caching to keep things fast\n- ‚úÖ Zero maintenance overhead\n\nThe sensors are now monitoring my freezer temperature and water tank levels, with alerts configured so I know immediately if something needs attention. Bob's original hardware and cloud service remain unchanged - the proxy just adds the features I needed on top.\n\n*Pro tip*: If you're dealing with any HTTP-only service that you need to access securely or extend with additional features, Cloudflare Workers is an excellent solution. The development experience is smooth, deployment is instant, and the global performance is hard to beat.\n\nNext up, I'm thinking about adding trend analysis and maybe some simple dashboards. But honestly, having reliable alerts for critical environmental monitoring has already solved my biggest problem.\n\nThe code is open source at [github.com/adamb/spider](https://github.com/adamb/spider) if you want to build something similar for your own sensors or services.\n";
      
      function restoreOriginal() {
        // Simply reload the page to restore original content
        window.location.reload();
      }
      
      async function transformPost(tone) {
        console.log('transformPost called with tone:', tone);
        
        // Show loading indicator
        const loadingIndicator = document.getElementById('loading-indicator');
        console.log('Loading indicator element:', loadingIndicator);
        if (loadingIndicator) {
          loadingIndicator.style.display = 'block';
        }
        
        try {
          const response = await fetch('/transform', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              tone: tone,
              content: originalMarkdownForAI
            })
          });
          
          if (response.ok) {
            const data = await response.json();
            if (data.transformedContent) {
              // Convert markdown to HTML for transformed content
              let transformedHtml = data.transformedContent;
              
              // Convert headers (order matters - do h3 first)
              transformedHtml = transformedHtml.replace(/^### (.+)$/gm, '<h3>$1</h3>');
              transformedHtml = transformedHtml.replace(/^## (.+)$/gm, '<h2>$1</h2>');
              transformedHtml = transformedHtml.replace(/^# (.+)$/gm, '<h1>$1</h1>');
              
              // Convert bold and italic
              transformedHtml = transformedHtml.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
              transformedHtml = transformedHtml.replace(/\*([^*]+)\*/g, '<em>$1</em>');
              
              // Convert links
              transformedHtml = transformedHtml.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2">$1</a>');
              
              // Convert simple line breaks and paragraphs
              transformedHtml = transformedHtml.replace(/\n\n/g, '</p><p>');
              transformedHtml = transformedHtml.replace(/\n/g, '<br>');
              transformedHtml = '<p>' + transformedHtml + '</p>';
              
              // Clean up empty paragraphs
              transformedHtml = transformedHtml.replace(/<p><\/p>/g, '');
              transformedHtml = transformedHtml.replace(/<p>(<h[1-6]>)/g, '$1');
              transformedHtml = transformedHtml.replace(/(<\/h[1-6]>)<\/p>/g, '$1');
              
              document.getElementById('post-content').innerHTML = 
                '<div class="transformed-content"><em>üé≠ ' + tone.charAt(0).toUpperCase() + tone.slice(1) + ' version:</em><br><br>' + 
                transformedHtml + '</div>';
            }
          } else {
            document.getElementById('post-content').innerHTML = 
              '<div class="transformed-content"><em>‚ùå Failed to transform content. Try again!</em></div>';
          }
        } catch (error) {
          console.error('Transformation error:', error);
          const postContent = document.getElementById('post-content');
          if (postContent) {
            postContent.innerHTML = 
              '<div class="transformed-content"><em>‚ùå Network error: ' + error.message + '</em></div>';
          }
        }
        
        // Hide loading indicator
        document.getElementById('loading-indicator').style.display = 'none';
      }
    </script>
  
    
    <div class="back-link"><a href="/">‚Üê Back to Home</a></div>
  </article>
  </main>

  <footer>
    <p><a href="/about">About</a> ‚Ä¢ ¬© 2025 Adam Beguelin ‚Ä¢ main@a18c83e</p>
  </footer>
</body>
</html>
